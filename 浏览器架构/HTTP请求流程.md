[TOC]
# HTTP请求流程

## 浏览器端发起HTTP请求流程

### 构建请求

- 构建请求行信息，构建好后，准备发送网路请求

### 查找缓存

- 在真正浏览器请求发起之前，浏览器会先在缓存中查看是否有请求的文件

	- 如果有，浏览器会拦截请求，返回资源的副本，然后直接结束请求
	- 如果没有，则进入网络请求过程

### 准备IP地址和端口

- HTTP的内容是通过TCP的传输数据阶段来实现的
- 请求DNS返回域名对应的IP
- 如果没有指定端口号，那么默认是80

### 等待TCP队列

- chrome机制，同一个域名最多只能建立6个TCP连接，如果当前请求数量小于6，那么会进入下一步，否则会等待

### 建立TCP连接

### 发送HTTP请求

- 浏览器会首先向服务器发送请求行信息，包括请求方法、请求uri和http版本
- GET和POST

	- 如果是POST，那么浏览器还会准备数据，通过请求体发送

- 浏览器还会以请求头方式发送一些其他信息

## 服务器端处理HTTP请求流程

### 返回请求

- 首先会返回响应行，包括http版本和状态码
- 响应头和响应体

### 断开连接

- 一般情况下，一旦服务器向浏览器返回了数据，他就要关闭TCP连接
- 不过如果浏览器或者服务器在其头信息中加入了connection: keep-alive，那么不会关闭连接

### 重定向

- 状态码301和302
- 响应头中的location字段是需要重定向的网址，浏览器获取location中的字段，使用该地址重新导航

## 解答问题

### 1. 为什么很多站点第二次打开速度会很快

- 浏览器第一次加载页面的过程中，缓存了一些耗时的资源

	- DNS缓存和页面资源缓存

- 页面缓存

	- 服务器在响应头中的cache-control字段来设置

		- max-age 秒

	- if-none-match

### 2. 登录状态是如何保持的

- cookie

*XMind: ZEN - Trial Version*